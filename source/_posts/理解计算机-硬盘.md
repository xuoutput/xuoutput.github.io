---
title: 理解计算机-硬盘
date: 2020-02-15 21:06:39
tags:
- 硬盘
categories:
- os教程
comments: false
permalink:
---

# 理解计算机-硬盘

每款新硬盘在出厂后均默认处于未分区状态，用户装系统、存储数据前必须要分区。那对于“硬盘分区”您了解多少呢？分区方式带来哪一些弊病呢？SSD 固态硬盘分区又需要注意什么呢？今天我们就来探讨一下，“硬盘分区”那点事！

当新硬盘接入计算机，打开磁盘管理时会提示让你选择 MBR 或者 GPT，这两个到底有什么区别呢？

1、装 XP 必须 MBR
2、MBR 不支持 2TB 以上的分区
3、如果你买了个容量在 3TB 以上的硬盘，并把它们分配一个独立分区，必须选择 GPT。

为什么 4K 对齐如此重要：

我们知道机械硬盘的读写操作一直是以扇区为单位，以前每个扇区的尺寸都是 512 字节，直到近年来，大容量的机械硬盘的扇区尺寸提高至 4096 字节（我们所说的 4KB），而电脑文件系统（FAT、NTFS 等），一直都习惯以 512 字节的扇区单位来操作硬盘。

而 SSD 的读写操作不同机械硬盘，SSD 读写的最小单位叫“页”(常见尺寸为 4KB，实际视具体颗粒而定)，闪存颗粒不允许像机械硬盘一样覆盖写入。因此在有数据的地方要写入新数据，就需要先进行擦除操作，而擦除的最小单位是块（每个块都由很多个页组成）。

传统的分区偏移尺寸一直是从磁盘的第 63 个扇区（63X512B=31.5KB）开始，因此第一个用户数据的前 4KB，都肯定是存放在系统"逻辑扇区"的 31.5KB~35.5KB 之间，在 SSD 上，这样就会导致所有数据都横跨在 2 个页之间，从上面 SSD 的特性可以知道，这种情况必然导致 SSD 的性能受严重影响（特别是随机性能），因为每次的写入操作在 SSD 上都变成了读-擦-写操作。

## 硬盘结构

![HDDspin](HDDspin.jpeg)

![hd2.webp](hd2.webp)

磁道(track): 当磁盘旋转时，磁头若保持在一个位置上，则每个磁头都会在磁盘表面划出一个圆形轨迹，这些圆形轨迹就叫磁道.

扇区(sector): 分区格式化磁盘时，每个盘片的每一面都会划分很多同心圆的磁道，而且还会将每个同心圆进一步的分割为多个相等的圆弧，这些圆弧就是扇区. 扇区是磁盘的最小组成单元，通常是 512 字节。（由于不断提高磁盘的大小，部分厂商设定每个扇区的大小是 4096 字节）

> 扇区是一个磁道上的一块, 不是所有磁道上相同弧度的那么多磁道, 也不是上图那块蓝色的

柱面(cylinder): 硬盘通常由一个或多个盘片构成，而且每个面都被划分为数目相等的磁道，并从外缘开始编号（即最边缘的磁道为 0 磁道，往里依次累加）。如此磁盘中具有相同编号的磁道会形成一个圆柱，此圆柱称为磁盘的柱面。

> 磁盘的柱面数与一个盘面上的磁道数是相等的。由于每个盘面都有一个磁头，因此，盘面数等于总的磁头数。

盘面或盘片(platter): 盘片数量都受到限制，一般都在 5 片以内。盘片的编号自下向上从 0 开始(还是从上到下?)，如最下边的盘片有 0 面和 1 面，再上一个盘片就编号为 2 面和 3 面。

簇(cluster): 几个扇区一组

- 针对不同年代的硬盘，Sector 的划分方式不同。
- 旧时的小容量硬盘每个 Disc 上每个 Track 都划分为等量的 Sector，便于数据读取。
- 每个 Track 等量的 Sector 分配对位于 Disc 外部的 Track 非常浪费，所以近代大容量磁盘采用了一种新的划分 Sector 的方法，即 ZBR。ZBR 将磁盘不同的 Track 划分为多个 Zone，同一 Zone 的 Track 具有等量的 Sector。位于 Disc 外侧 Zone 的 Track 划分的 Sector 数量要比内侧的 Zone 的 Track 多。

![track2.webp](track2.webp)

## CYLINDER – HEAD – SECTOR (CHS) 柱面-磁头-扇区

CHS 用于表述存放到物理磁盘上数据的位置。

ECHS
CHS 方式最多能描述 504M 的磁盘大小，所以 ECHS（Extended CHS）方式出现了。

### 区别

扇区 sector： 硬盘的最小读写单元
块/簇 cluster： 是操作系统针对硬盘读写的最小单元
page： 是内存与操作系统之间操作的最小单元。

## ZBR

一个小容量的磁盘（<=8GB），**每个 track 包含的 Sector 数量是相同的**，位于磁盘外部的 Track bits 密度低，内部的 Track bits 密度高。

每个 Track 分配相同数量的 Sector，对磁盘容量是一个较大的浪费，外部 Track 本应该容纳更多的数据。ZBR 提供了一种**可变**的 Sector/Track 对应关系，**使内、外 Track 承载不同数量的 Sector**，更有效的提升了磁盘容量，使更大容量的磁盘成为可能。

ZBR 环境下，Cylinder、Header、Sector 的位置发生了巨大的变化（见下图），所以传统的 CHS 寻址方式已经不能满足要求，需要寻求一种新的寻址模式。

![ZBR.webp](ZBR.webp)
![track2.webp](track2.webp)

### Logical Block Addressing

ZBR环境下不能使用CHS方式寻址数据了，所以引入了一种新的寻址模式，也就是LBA，LBA是基于CHS寻址方式转换而来的（Translation Method）。
其使用linear sheme表述地址，使用Sector作为基本单位（其概念中第一个Sector是Sector 0）。
LBA作为一种新的寻址方式，并不被广大操作系统和BIOS所熟知，他们依旧使用传统的CHS寻址方式，磁盘Controller会负责将LBA (physical geometry) 翻译为 CHS addressing (logical geometry) 供操作系统和BIOS使用。

## 令人迷惑的地方

A：磁道 (track 最外圈的磁道数最小) 粉色的一圈
B：扇面 (platter) 蓝色的一块, platters 不是这么分的, 一张光盘的一面就是一个扇面
C：扇区 (sector) 大红色一条
D：簇（扇区组）绿色的
在硬盘上定位某一数据记录位置—C 扇区，使用了三维定位。
![640px-Disk-structure2.svg.png](640px-Disk-structure2.svg.png)

## 参考

[磁盘基础结构（理论）666666](https://www.jianshu.com/p/2b171971ba3b)

[硬盘的物理结构和工作原理](https://www.jianshu.com/p/42308db1fcde)
[硬盘基本知识（磁头、磁道、扇区、柱面）](https://www.cnblogs.com/jswang/p/9071847.html)
[深入解析硬盘结构](https://caibaoz.com/blog/2013/08/02/harddisk_structure_indepth/)

[硬盘分区您了解多少?编辑手把手教你](https://diy.pconline.com.cn/449/4498736_all.html)
