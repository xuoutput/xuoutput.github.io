---
title: å†è°ˆjsä½œç”¨åŸŸ
date: 2019-02-12 19:19:09
tags:
- javascript
- ä½œç”¨åŸŸé“¾
categories:
- javascriptæ•™ç¨‹
comments: false
permalink:
---

# å†è°ˆjsä½œç”¨åŸŸ

åœ¨ä¸Šä¸€ç¯‡{% post_link jsä½œç”¨åŸŸé“¾å’Œé—­åŒ… jsä½œç”¨åŸŸé“¾å’Œé—­åŒ… %}ä¸­è®²çš„æœ‰ç‚¹æ²¡å¤´ç»ª, é‡æ–°æ¢³ç†ä¸‹

## scope, scope chain, execution context, context çš„åŒºåˆ«

### å…ˆè§£é‡Šä¸‹å‡½æ•°å’Œä½œç”¨åŸŸçš„å…³ç³»

æ¯ä¸€ä¸ª`JavaScript`å‡½æ•°éƒ½è¢«è¡¨ç¤ºä¸º`object`,è¿›ä¸€æ­¥, as an instance of `Function`, å‡½æ•°å¯¹è±¡å’Œå…¶ä»–å¯¹è±¡ä¸€æ ·, æ‹¥æœ‰ä½ å¯ä»¥ç¼–ç¨‹è®¿é—®çš„å±æ€§, å’Œä¸€ç³»åˆ—ä¸èƒ½è¢«è®¿é—®, ä½†ä»…ä¾›`JavaScript`å¼•æ“ä½¿ç”¨çš„å†…éƒ¨å±æ€§. å…¶ä¸­ä¸€ä¸ªå†…éƒ¨å±æ€§å°±æ˜¯`[[scope]]`.

è¿™ä¸ªå†…éƒ¨å±æ€§`[[scope]]`åŒ…å«ä¸€ä¸ªä»£è¡¨ä½œç”¨åŸŸ`scope`çš„å¯¹è±¡é›†åˆ, è¿™ä¸ªé›†åˆæ˜¯åœ¨å‡½æ•°è¢«åˆ›å»ºæ—¶äº§ç”Ÿçš„. è¿™ä¸ªé›†åˆå«å‡½æ•°çš„`ä½œç”¨åŸŸé“¾`, ä»–å†³å®šäº†å‡½æ•°èƒ½è®¿é—®å“ªäº›æ•°æ®. è¿™ä¸ªé›†åˆä¸­çš„æ¯ä¸ªå¯¹è±¡å«åšå¯å˜å¯¹è±¡`variable object`. å½“ä¸€ä¸ªå‡½æ•°è¢«åˆ›å»ºå, ä»–çš„ä½œç”¨åŸŸé“¾å°±æœ‰è¿™äº›å¯¹è±¡.

> ä¸Šé¢çš„åˆ›å»ºæŒ‡å†™å¥½ä»£ç , åªæ˜¯å®šä¹‰å“¦, è¿˜æ²¡è¿è¡Œå‘¢.

### ä½œç”¨åŸŸscope

ä½œç”¨åŸŸæ˜¯ä½ çš„ä»£ç åœ¨**è¿è¡Œæ—¶(ä¸è¿è¡Œæ—¶ä¹Ÿæ˜¯å¯ä»¥äº§ç”Ÿçš„é™æ€ä½œç”¨åŸŸé“¾, æ˜¯éè‡ªå·±éƒ¨åˆ†çš„å“¦)**ï¼Œå„ä¸ªå˜é‡ã€å‡½æ•°å’Œå¯¹è±¡çš„å¯è®¿é—®æ€§ã€‚æ¢å¥è¯è¯´ï¼Œä½œç”¨åŸŸå†³å®šäº†ä½ çš„ä»£ç é‡Œçš„å˜é‡å’Œå…¶ä»–èµ„æºåœ¨å„ä¸ªåŒºåŸŸä¸­çš„å¯è§æ€§ã€‚

jsæœ‰3ç§ä½œç”¨åŸŸ, å…¨å±€ä½œç”¨åŸŸ, å±€éƒ¨ä½œç”¨åŸŸ(å‡½æ•°å†…), å—çº§ä½œç”¨åŸŸ`{}`å’Œ`const let`

### ä¸Šä¸‹æ–‡ context

ä¸Šä¸‹æ–‡æŒ‡çš„æ˜¯åœ¨**ç›¸åŒçš„ä½œç”¨åŸŸ**ä¸­çš„`this`çš„å€¼, è¿™é‡Œ`this`æ˜¯åœ¨è°ƒç”¨æ—¶ç¡®å®šçš„(æœ¬å‡½æ•°çš„`this`å€¼), è€Œä½œç”¨åŸŸ`scope`ä¹Ÿæ˜¯è¿è¡Œæ—¶æ‰æœ‰çš„. æ‰€ä»¥æ²¡é”™.

## ä¾‹å­add()

ä¸»è¦æ˜¯çœ‹è¿™ä¸ªé“¾æ¥
[JavaScript æ ¸å¿ƒæ¦‚å¿µä¹‹ä½œç”¨åŸŸå’Œé—­åŒ… 666](https://www.css88.com/archives/7262)

```JavaScript
function add(num1, num2) {
  var sum = num1 + num2;
  return sum;
}
```

### Scope Chainï¼ˆä½œç”¨åŸŸé“¾ï¼‰

> ä½œç”¨åŸŸé“¾çš„**éè‡ªå·±éƒ¨åˆ†**åœ¨å‡½æ•°å¯¹è±¡è¢«å»ºç«‹ï¼ˆ**å‡½æ•°å£°æ˜ã€å‡½æ•°è¡¨è¾¾å¼**ï¼‰çš„æ—¶å€™å»ºç«‹ï¼Œ**è€Œä¸éœ€è¦ç­‰åˆ°æ‰§è¡Œ**ï¼Œè¿™éƒ¨åˆ†**ä½œç”¨åŸŸé“¾æ˜¯é™æ€**çš„ï¼›å½“å‡½æ•°æ‰§è¡Œæ—¶ï¼Œ**å»ºç«‹ä¸€ä¸ªè‡ªå·±å½“æ¬¡æ‰§è¡Œçš„ä½œç”¨åŸŸ**ï¼Œç„¶åæŠŠè¿™ä¸ªä½œç”¨åŸŸä¸å‰é¢çš„ä½œç”¨åŸŸé“¾å…³è”èµ·æ¥

æ‰€ä»¥, å½“**å®šä¹‰** `add` å‡½æ•°åï¼Œå…¶**ä½œç”¨åŸŸé“¾å°±åˆ›å»ºäº†**ã€‚å‡½æ•°æ‰€åœ¨çš„å…¨å±€ä½œç”¨åŸŸçš„å…¨å±€å¯¹è±¡è¢«æ”¾ç½®åˆ° `add` å‡½æ•°ä½œç”¨åŸŸé“¾ï¼ˆ`[[scope]`] å±æ€§ï¼‰ä¸­ã€‚æˆ‘ä»¬å¯ä»¥ä»ä¸‹å›¾ä¸­çœ‹åˆ°ä½œç”¨åŸŸé“¾çš„ç¬¬ä¸€ä¸ªå¯¹è±¡ä¿å­˜çš„æ˜¯å…¨å±€å¯¹è±¡ï¼Œå…¨å±€å¯¹è±¡ä¸­ä¿å­˜äº†è¯¸å¦‚ `this` , `window` , `document` ä»¥åŠå…¨å±€å¯¹è±¡ä¸­çš„ `add` å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ä»–è‡ªå·±ã€‚è¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¯ä»¥åœ¨å…¨å±€ä½œç”¨åŸŸä¸‹çš„å‡½æ•°ä¸­è®¿é—® `window(this)`ï¼Œè®¿é—®å…¨å±€å˜é‡ï¼Œè®¿é—®å‡½æ•°è‡ªèº«çš„åŸå› ã€‚
ä½œç”¨åŸŸé“¾åœ¨ç¨åçš„æ‰§è¡Œå‡½æ•°æ—¶ä½¿ç”¨ã€‚å½“ç„¶è¿˜æœ‰å‡½æ•°ä½œç”¨åŸŸä¸æ˜¯å…¨å±€çš„æƒ…å†µï¼Œç­‰ä¼šå„¿æˆ‘ä»¬å†è®¨è®ºã€‚

![scope1.jpg](scope1.jpg)

[å®ä¾‹åˆ†æ JavaScript ä½œç”¨åŸŸ](https://www.css88.com/archives/7300)

ä¸Šé¢è¿™ä¸ªé“¾æ¥è®²äº† **JavaScript çš„è¯æ³•ä½œç”¨åŸŸ**

### Execution Contextï¼ˆæ‰§è¡ŒæœŸä¸Šä¸‹æ–‡ï¼‰

> ä¹Ÿåˆ†**å…¨å±€æ‰§è¡ŒæœŸä¸Šä¸‹æ–‡**å’Œ**å‡½æ•°æ‰§è¡ŒæœŸä¸Šä¸‹æ–‡**

å‡è®¾æˆ‘ä»¬**è¿è¡Œ**ä»¥ä¸‹ä»£ç ï¼š

```JavaScript
var total = add(5, 10);
```

æ‰§è¡Œè¯¥å‡½æ•°åˆ›å»ºä¸€ä¸ª**å†…éƒ¨å¯¹è±¡**ï¼Œç§°ä¸º `Execution Context`ï¼ˆæ‰§è¡ŒæœŸä¸Šä¸‹æ–‡ï¼‰ã€‚æ‰§è¡ŒæœŸä¸Šä¸‹æ–‡**å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°`æ­£åœ¨æ‰§è¡Œæ—¶`çš„ä½œç”¨åŸŸç¯å¢ƒ**ã€‚
> ç‰¹åˆ«æ³¨æ„ï¼Œæ‰§è¡ŒæœŸä¸Šä¸‹æ–‡å’Œæˆ‘ä»¬å¹³å¸¸è¯´çš„ä¸Šä¸‹æ–‡ä¸åŒï¼Œ`æ‰§è¡ŒæœŸä¸Šä¸‹æ–‡`æŒ‡çš„æ˜¯ä½œç”¨åŸŸ`scope`ã€‚å¹³å¸¸è¯´çš„ä¸Šä¸‹æ–‡æ˜¯`this`çš„å–å€¼æŒ‡å‘ã€‚

æ‰§è¡ŒæœŸä¸Šä¸‹æ–‡å’Œå‡½æ•°åˆ›å»ºæ—¶çš„ä½œç”¨åŸŸé“¾å¯¹è±¡`[[scope]]`åŒºåˆ†ï¼Œè¿™æ˜¯**ä¸¤ä¸ªä¸åŒçš„ä½œç”¨åŸŸé“¾å¯¹è±¡**ã€‚åˆ†å¼€çš„åŸå› å¾ˆç®€å•ï¼Œå‡½æ•°å®šä¹‰æ—¶çš„ä½œç”¨åŸŸé“¾å¯¹è±¡ `[[scope]]` æ˜¯å›ºå®šçš„ï¼Œè€Œ `æ‰§è¡ŒæœŸä¸Šä¸‹æ–‡` ä¼šæ ¹æ®ä¸åŒçš„è¿è¡Œæ—¶ç¯å¢ƒå˜åŒ–ã€‚è€Œä¸”è¯¥å‡½æ•°æ¯æ‰§è¡Œä¸€æ¬¡ï¼Œéƒ½ä¼šåˆ›å»ºå•ç‹¬çš„ `æ‰§è¡ŒæœŸä¸Šä¸‹æ–‡`ï¼Œå› æ­¤å¯¹åŒä¸€å‡½æ•°è°ƒç”¨å¤šæ¬¡ï¼Œä¼šå¯¼è‡´åˆ›å»ºå¤šä¸ªæ‰§è¡ŒæœŸä¸Šä¸‹æ–‡ã€‚ä¸€æ—¦å‡½æ•°æ‰§è¡Œå®Œæˆï¼Œæ‰§è¡ŒæœŸä¸Šä¸‹æ–‡å°†è¢«é”€æ¯ã€‚
> å‡½æ•°å®šä¹‰æ—¶å‡½æ•°å¯¹è±¡çš„å±æ€§æ˜¯ `[[scope]]` ,è€Œ`Execution Context`ï¼ˆæ‰§è¡ŒæœŸä¸Šä¸‹æ–‡ï¼‰çš„å±æ€§æ˜¯`scope chain`

`æ‰§è¡ŒæœŸä¸Šä¸‹æ–‡å¯¹è±¡`æœ‰è‡ªå·±çš„ä½œç”¨åŸŸé“¾ï¼Œå½“åˆ›å»ºæ‰§æœŸè¡Œä¸Šä¸‹æ–‡æ—¶ï¼Œå…¶ä½œç”¨åŸŸé“¾å°†**ä½¿ç”¨**æ‰§è¡Œå‡½æ•°`[[scope]]`å±æ€§æ‰€åŒ…å«çš„å¯¹è±¡ï¼ˆå³ï¼Œå‡½æ•°**å®šä¹‰æ—¶**çš„ä½œç”¨åŸŸé“¾å¯¹è±¡ï¼‰è¿›è¡Œ**åˆå§‹åŒ–**ã€‚è¿™äº›å€¼æŒ‰ç…§å®ƒä»¬åœ¨å‡½æ•°ä¸­å‡ºç°çš„é¡ºåºå¤åˆ¶åˆ°æ‰§è¡ŒæœŸä¸Šä¸‹æ–‡ä½œç”¨åŸŸé“¾ä¸­ã€‚

### Activation Objectï¼ˆæ¿€æ´»å¯¹è±¡ï¼‰

éšåï¼Œåœ¨æ‰§è¡Œå…¶ä¸Šä¸‹æ–‡**ä¸­**åˆ›å»ºä¸€ä¸ªåä¸º `Activation Object`ï¼ˆæ¿€æ´»å¯¹è±¡ï¼‰çš„`æ–°å¯¹è±¡`ã€‚ è¿™ä¸ª`æ¿€æ´»å¯¹è±¡AO`ä¿å­˜äº†å‡½æ•°ä¸­çš„`æ‰€æœ‰å½¢å‚ï¼Œå®å‚ï¼Œå±€éƒ¨å˜é‡ï¼Œthis æŒ‡é’ˆç­‰`å‡½æ•°æ‰§è¡Œæ—¶å‡½æ•°å†…éƒ¨çš„æ•°æ®æƒ…å†µã€‚ç„¶åå°†è¿™ä¸ªæ¿€æ´»å¯¹è±¡æ¨é€åˆ°æ‰§è¡Œå…¶ä¸Šä¸‹æ–‡ä½œç”¨åŸŸé“¾çš„**é¡¶éƒ¨**ã€‚

`æ¿€æ´»å¯¹è±¡AO`æ˜¯ä¸€ä¸ª**å¯å˜å¯¹è±¡**ï¼Œé‡Œé¢çš„æ•°æ®éšç€å‡½æ•°æ‰§è¡Œæ—¶çš„æ•°æ®çš„å˜åŒ–è€Œå˜åŒ–ï¼Œå½“å‡½æ•°æ‰§è¡Œç»“æŸä¹‹åï¼Œæ‰§è¡ŒæœŸä¸Šä¸‹æ–‡å°†è¢«é”€æ¯ã€‚ä¹Ÿå°±ä¼šé”€æ¯`Execution Context`çš„ä½œç”¨åŸŸé“¾ï¼Œæ¿€æ´»å¯¹è±¡ä¹ŸåŒæ ·è¢«é”€æ¯ã€‚**ä½†å¦‚æœå­˜åœ¨é—­åŒ…**ï¼Œæ¿€æ´»å¯¹è±¡å°±ä¼šä»¥å¦å¤–ä¸€ç§æ–¹å¼å­˜åœ¨ï¼Œè¿™ä¹Ÿæ˜¯**é—­åŒ…äº§ç”Ÿçš„çœŸæ­£åŸå› **ï¼Œå…·ä½“çš„æˆ‘ä»¬ç¨åè®¨è®ºã€‚ä¸‹å›¾æ˜¾ç¤ºäº†æ‰§è¡Œä¸Šä¸‹æ–‡åŠå…¶ä½œç”¨åŸŸé“¾ï¼š

![scope_execution.jpg](scope_execution.jpg)

ä»å·¦å¾€å³çœ‹ï¼Œ**ç¬¬ä¸€éƒ¨åˆ†**æ˜¯å‡½æ•°**æ‰§è¡Œæ—¶**åˆ›å»ºçš„`æ‰§è¡ŒæœŸä¸Šä¸‹æ–‡`ï¼Œå®ƒæœ‰è‡ªå·±çš„ä½œç”¨åŸŸé“¾ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯ä½œç”¨åŸŸé“¾ä¸­çš„å¯¹è±¡ï¼Œ`ç´¢å¼•ä¸º1`çš„å¯¹è±¡æ˜¯ä»`[[scope]]`ä½œç”¨åŸŸé“¾ä¸­**å¤åˆ¶**è¿‡æ¥çš„ï¼Œ`ç´¢å¼•ä¸º0`çš„å¯¹è±¡æ˜¯åœ¨**å‡½æ•°æ‰§è¡Œæ—¶**åˆ›å»ºçš„`æ¿€æ´»å¯¹è±¡AO`ï¼Œç¬¬ä¸‰éƒ¨åˆ†æ˜¯ä½œç”¨åŸŸé“¾ä¸­çš„å¯¹è±¡çš„å†…å®¹`Activation Object`(æ¿€æ´»å¯¹è±¡)å’Œ`Global Object`(å…¨å±€å¯¹è±¡)ã€‚

å‡½æ•°åœ¨æ‰§è¡Œæ—¶ï¼Œæ¯é‡åˆ°ä¸€ä¸ªå˜é‡ï¼Œéƒ½ä¼šå»æ‰§è¡ŒæœŸä¸Šä¸‹æ–‡çš„ä½œç”¨åŸŸé“¾çš„é¡¶éƒ¨ï¼Œæ‰§è¡Œå‡½æ•°çš„æ¿€æ´»å¯¹è±¡å¼€å§‹å‘ä¸‹**æœç´¢**ï¼Œå¦‚æœåœ¨ç¬¬ä¸€ä¸ªä½œç”¨åŸŸé“¾ï¼ˆå³ï¼Œ`Activation Object` æ¿€æ´»å¯¹è±¡ï¼‰ä¸­æ‰¾åˆ°äº†ï¼Œé‚£ä¹ˆå°±è¿”å›è¿™ä¸ªå˜é‡ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œé‚£ä¹ˆç»§ç»­å‘ä¸‹æŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°ä¸ºæ­¢ã€‚å¦‚æœåœ¨æ•´ä¸ªæ‰§è¡ŒæœŸä¸Šä¸‹æ–‡ä¸­éƒ½æ²¡æœ‰æ‰¾åˆ°è¿™ä¸ªå˜é‡ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯¥å˜é‡è¢«è®¤ä¸ºæ˜¯**æœªå®šä¹‰**çš„ã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆå‡½æ•°å¯ä»¥è®¿é—®å…¨å±€å˜é‡ï¼Œå½“å±€éƒ¨å˜é‡å’Œå…¨å±€å˜é‡åŒåæ—¶ï¼Œä¼šä½¿ç”¨å±€éƒ¨å˜é‡è€Œä¸ä½¿ç”¨å…¨å±€å˜é‡ï¼Œä»¥åŠ JavaScript ä¸­å„ç§çœ‹ä¼¼æ€ªå¼‚çš„ã€æœ‰è¶£çš„ä½œç”¨åŸŸé—®é¢˜çš„ç­”æ¡ˆã€‚

### é—­åŒ…

> å°¤å…¶æ˜¯æ³¨æ„é—­åŒ…çš„å®šä¹‰å“¦, è¦ä½¿ç”¨åˆ°çˆ¶å‡½æ•°çš„å˜é‡

è¿™ä¸ªçœ‹{% post_link jsä½œç”¨åŸŸé“¾å’Œé—­åŒ… jsä½œç”¨åŸŸé“¾å’Œé—­åŒ… %}ä¸­çš„é—­åŒ…

## JavaScript çš„è¯æ³•ä½œç”¨åŸŸ

çœ‹å®Œé—­åŒ…åè¦çœ‹è¿™ä¸ªé“¾æ¥å·©å›º, åœ¨æ•´ä½“å›é¡¾.

[å®ä¾‹åˆ†æ JavaScript ä½œç”¨åŸŸ](https://www.css88.com/archives/7300)

ä¸Šé¢è¿™ä¸ªé“¾æ¥è®²äº† **JavaScript çš„è¯æ³•ä½œç”¨åŸŸ**

ç®€è¦è¯´ä¸‹:

å¦‚æœä¸€ä¸ªæ–‡æ¡£æµä¸­åŒ…å«å¤šä¸ªscriptä»£ç æ®µï¼ˆç”¨scriptæ ‡ç­¾åˆ†éš”çš„jsä»£ç æˆ–å¼•å…¥çš„jsæ–‡ä»¶ï¼‰ï¼Œå®ƒä»¬çš„è¿è¡Œé¡ºåºæ˜¯ï¼š

1. è¯»å…¥ç¬¬ä¸€ä¸ªä»£ç æ®µï¼ˆjsæ‰§è¡Œå¼•æ“å¹¶éä¸€è¡Œä¸€è¡Œåœ°åˆ†æç¨‹åºï¼Œè€Œæ˜¯ä¸€æ®µä¸€æ®µåœ°åˆ†ææ‰§è¡Œçš„ï¼‰
2. åš**è¯æ³•åˆ†æ**ï¼Œæœ‰é”™åˆ™æŠ¥è¯­æ³•é”™è¯¯ï¼ˆæ¯”å¦‚æ‹¬å·ä¸åŒ¹é…ç­‰ï¼‰ï¼Œå¹¶è·³è½¬åˆ°æ­¥éª¤5
3. å¯¹`var`å˜é‡å’Œ`function`å®šä¹‰åšâ€œ**é¢„è§£æ**â€œï¼ˆæ°¸è¿œä¸ä¼šæŠ¥é”™çš„ï¼Œå› ä¸ºåªè§£ææ­£ç¡®çš„å£°æ˜ï¼‰
4. æ‰§è¡Œä»£ç æ®µï¼Œæœ‰é”™åˆ™æŠ¥é”™ï¼ˆæ¯”å¦‚å˜é‡æœªå®šä¹‰ï¼‰
5. å¦‚æœè¿˜æœ‰ä¸‹ä¸€ä¸ªä»£ç æ®µï¼Œåˆ™è¯»å…¥ä¸‹ä¸€ä¸ªä»£ç æ®µï¼Œé‡å¤æ­¥éª¤2
6. å®Œæˆ

### JavaScript è§£æè¿‡ç¨‹

> ä»å‰é¢çš„**ä¾‹å­add()**å›é¡¾ä¸‹

`JavaScript` ä¸­æ¯ä¸ªå‡½æ•°éƒ½éƒ½è¡¨ç¤ºä¸ºä¸€ä¸ªå‡½æ•°å¯¹è±¡ï¼ˆå‡½æ•°å®ä¾‹ï¼‰ï¼Œå‡½æ•°å¯¹è±¡æœ‰ä¸€ä¸ªä»…ä¾› `JavaScript` å¼•æ“ä½¿ç”¨çš„`[[scope]]` å±æ€§ã€‚**é€šè¿‡è¯­æ³•åˆ†æå’Œé¢„è§£æ**ï¼Œå°†`[[scope]]` å±æ€§æŒ‡å‘**å‡½æ•°å®šä¹‰æ—¶**ä½œç”¨åŸŸä¸­çš„æ‰€æœ‰å¯¹è±¡é›†åˆã€‚è¿™ä¸ªé›†åˆè¢«ç§°ä¸ºå‡½æ•°çš„ä½œç”¨åŸŸé“¾ï¼ˆ`scope chain`ï¼‰ï¼ŒåŒ…å«å‡½æ•°**å®šä¹‰æ—¶**ä½œç”¨åŸŸä¸­æ‰€æœ‰å¯è®¿é—®çš„æ•°æ®ã€‚

å¯¹åº”çš„å›¾æ˜¯:

![scope1.jpg](scope1.jpg)

### JavaScript æ‰§è¡Œè¿‡ç¨‹

**æ‰§è¡Œ**å…·ä½“çš„æŸä¸ªå‡½æ•°æ—¶ï¼ŒJSå¼•æ“åœ¨æ‰§è¡Œæ¯ä¸ªå‡½æ•°å®ä¾‹æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ª`æ‰§è¡ŒæœŸä¸Šä¸‹æ–‡ï¼ˆExecution Context`ï¼‰å’Œ`æ¿€æ´»å¯¹è±¡ï¼ˆactive Object`ï¼‰ï¼ˆå®ƒä»¬**å±äº`å®¿ä¸»å¯¹è±¡`**ï¼Œä¸å‡½æ•°å®ä¾‹æ‰§è¡Œçš„ç”Ÿå‘½å‘¨æœŸä¿æŒä¸€è‡´ï¼Œä¹Ÿå°±æ˜¯å‡½æ•°æ‰§è¡Œå®Œæˆï¼Œè¿™äº›å¯¹è±¡ä¹Ÿå°±è¢«é”€æ¯äº†ï¼Œé—­åŒ…ä¾‹å¤–ã€‚ï¼‰

æ‰§è¡ŒæœŸä¸Šä¸‹æ–‡ï¼ˆ`Execution Context`ï¼‰å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°**æ­£åœ¨æ‰§è¡Œæ—¶**çš„ä½œç”¨åŸŸç¯å¢ƒã€‚å®ƒä½¿ç”¨å‡½æ•°`[[scope]]`å±æ€§è¿›è¡Œ**åˆå§‹åŒ–**ã€‚

éšåï¼Œæ‰§è¡ŒæœŸä¸Šä¸‹æ–‡ `é¡¶éƒ¨` çš„ä¼šåˆ›å»ºä¸€ä¸ª`æ¿€æ´»å¯¹è±¡ï¼ˆactive Objectï¼‰`ï¼Œè¿™ä¸ªæ¿€æ´»å¯¹è±¡ä¿å­˜äº†å‡½æ•°ä¸­çš„`æ‰€æœ‰å½¢å‚`ï¼Œ`å®å‚`ï¼Œ`å±€éƒ¨å˜é‡`ï¼Œ`this` æŒ‡é’ˆç­‰å‡½æ•°æ‰§è¡Œæ—¶**å‡½æ•°å†…éƒ¨**çš„æ•°æ®æƒ…å†µã€‚è¿™ä¸ªæ—¶å€™æ¿€æ´»å¯¹è±¡ä¸­çš„é‚£äº›å±æ€§**å¹¶æ²¡æœ‰è¢«èµ‹å€¼**ï¼Œæ‰§è¡Œå‡½æ•°å†…çš„èµ‹å€¼è¯­å¥ï¼Œè¿™æ‰ä¼šå¯¹å˜é‡é›†åˆä¸­çš„å˜é‡è¿›è¡Œèµ‹å€¼å¤„ç†ã€‚ä¹Ÿå°±æ˜¯è¯´ æ¿€æ´»å¯¹è±¡æ˜¯ä¸€ä¸ª**å¯å˜å¯¹è±¡**ï¼Œé‡Œé¢çš„æ•°æ®éšç€å‡½æ•°æ‰§è¡Œæ—¶çš„æ•°æ®å˜åŒ–è€Œå˜åŒ–ã€‚

ğŸŒ°
è€ƒè™‘ä¸€ä¸‹ä¸‹å›¾ä¸­çš„ä»£ç ï¼š

![lizi.png](lizi.png)

åˆ†æè¿‡ç¨‹ï¼š

- ä½œç”¨åŸŸ1 (ç»¿è‰²) ï¼šå³å…¨å±€ä½œç”¨åŸŸï¼ŒåŒ…å«å˜é‡`foo`;
- ä½œç”¨åŸŸ2 (é»„è‰²) ï¼š`foo`å‡½æ•°çš„ä½œç”¨åŸŸï¼ŒåŒ…å«å˜é‡`a`,`bar`,`b`
- ä½œç”¨åŸŸ3 (è“è‰²) ï¼š`bar`å‡½æ•°çš„ä½œç”¨åŸŸï¼ŒåŒ…å«å˜é‡`c`

`bar` ä½œç”¨åŸŸé‡Œå®Œæ•´çš„åŒ…å«äº† `foo` çš„ä½œç”¨åŸŸ, å› ä¸º `bar` æ˜¯å®šä¹‰åœ¨ `foo` ä¸­çš„ï¼Œäº§ç”Ÿ**åµŒå¥—ä½œç”¨åŸŸ**ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸåªæœ‰å¯èƒ½å­˜åœ¨äºä¸€ä¸ªçˆ¶çº§ä½œç”¨åŸŸä¸­ï¼Œä¸ä¼šåŒæ—¶å­˜åœ¨ä¸¤ä¸ªçˆ¶çº§ä½œç”¨åŸŸã€‚è¿˜æœ‰è¯¸å¦‚`this` , `window` , `document`ç­‰å…¨å±€å¯¹è±¡è¿™é‡Œå°±ä¸è¯´äº†ï¼Œé¿å…æ··ä¹±ã€‚

æ‰§è¡Œè¿‡ç¨‹ï¼š

- è¯­å¥`console.log`å¯»æ‰¾å˜é‡`a`,`b`,`c`;
- å…¶ä¸­`c`åœ¨è‡ªå·±çš„ä½œç”¨åŸŸä¸­æ‰¾åˆ°ï¼Œ
- `a`ï¼Œ`b`åœ¨è‡ªå·±çš„ä½œç”¨åŸŸä¸­æ‰¾ä¸åˆ°ï¼Œäºæ˜¯å‘ä¸Šçº§ä½œç”¨åŸŸä¸­æŸ¥æ‰¾ï¼Œåœ¨`foo`çš„ä½œç”¨åŸŸä¸­æ‰¾åˆ°ï¼Œå¹¶ä¸”è°ƒç”¨ã€‚

**å‡½æ•°åœ¨æ‰§è¡Œæ—¶**ï¼Œæ¯é‡åˆ°ä¸€ä¸ªå˜é‡ï¼Œéƒ½ä¼šå»**æ‰§è¡ŒæœŸä¸Šä¸‹æ–‡**çš„ä½œç”¨åŸŸé“¾çš„é¡¶éƒ¨ï¼Œä¹Ÿå°±æ˜¯**æ‰§è¡Œå‡½æ•°**çš„**æ¿€æ´»å¯¹è±¡**å¼€å§‹æœç´¢ï¼Œå¦‚æœåœ¨ç¬¬ä¸€ä¸ªä½œç”¨åŸŸé“¾ï¼ˆå³ï¼Œ`Activation Object` æ¿€æ´»å¯¹è±¡ï¼‰ä¸­æ‰¾åˆ°äº†ï¼Œé‚£ä¹ˆå°±è¿”å›è¿™ä¸ªå˜é‡ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œé‚£ä¹ˆç»§ç»­å‘ä¸‹æŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°ä¸ºæ­¢ã€‚å¦‚æœåœ¨æ•´ä¸ªæ‰§è¡ŒæœŸä¸Šä¸‹æ–‡ä¸­éƒ½æ²¡æœ‰æ‰¾åˆ°è¿™ä¸ªå˜é‡ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯¥å˜é‡è¢«è®¤ä¸ºæ˜¯æœªå®šä¹‰çš„ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœ`foo`çš„ä½œç”¨åŸŸä¸­ä¹Ÿå®šä¹‰äº†`c`ï¼Œä½†`bar`å‡½æ•°åªè°ƒç”¨è‡ªå·±ä½œç”¨åŸŸé‡Œçš„`c`ã€‚è¿™å°±æ˜¯æˆ‘ä»¬è¯´çš„å˜é‡å–å€¼ã€‚

#### å…³äºå½¢å‚, å®å‚, åŒåå±€éƒ¨å˜é‡çš„å…³ç³»

```JavaScript
function one(a,b,c) {
    console.log(one.length);//å½¢å‚æ•°é‡  3
}
function two(a,b,c,d,e,f,g){
    console.log(arguments.length);//å®å‚æ•°é‡  1
}
one(1)
two(1)
```

```JavaScript
function DoSomething(a)
{
  console.log(a); // 1
  console.log(arguments[0]); // 1
  var a = 2;
  console.log(a); // 2
  console.log(arguments[0]); // 2
}
DoSomething( 1 );
```

æ‰“å°çš„ç»“æœæ˜¯`1,1,2,2`ã€‚ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œå‚æ•°`a`å’Œå±€éƒ¨å˜é‡`a`å€¼æ˜¯**å®Œå…¨ç›¸åŒ**çš„ï¼Œå³ä½¿æ˜¯å±€éƒ¨å˜é‡`a`é‡æ–°å®šä¹‰å’Œèµ‹å€¼ä¹‹åã€‚è¿™æ ·å°±å¥½ç†è§£äº†ï¼Œ**å‚æ•°å’ŒåŒåå˜é‡**ä¹‹é—´æ˜¯ â€œ**å¼•ç”¨**â€ å…³ç³»ï¼Œä¹Ÿå°±æ˜¯è¯´ `JavaScript` å¼•æ“çš„å¤„ç†å‚æ•°å’ŒåŒåå±€éƒ¨å˜é‡æ˜¯éƒ½å¼•ç”¨åŒä¸€ä¸ªå†…å­˜åœ°å€ã€‚æ‰€ä»¥ç¤ºä¾‹5ä¸­ä¿®æ”¹å±€éƒ¨å˜é‡ä¼šå½±å“åˆ°`arguments`çš„æƒ…å†µå‡ºç°ã€‚

## å†å±•å¼€, execution contextä¸­æœ‰ä»€ä¹ˆ

çœ‹è¿™ä¸ªé“¾æ¥ä¸­çš„ä¸œè¥¿
[äº†è§£JavaScriptçš„æ‰§è¡Œä¸Šä¸‹æ–‡](https://yanhaijing.com/javascript/2014/04/29/what-is-the-execution-context-in-javascript/)
[ç”±å˜é‡æå‡è°ˆè°ˆ JavaScript Execution Context](https://juejin.im/post/5a5ee28f6fb9a01cbe655860)

### ä»€ä¹ˆæ˜¯æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Ÿ

è®©æˆ‘ä»¬å°†æœ¯è¯­`æ‰§è¡Œä¸Šä¸‹æ–‡`æƒ³è±¡ä¸ºå½“å‰è¢«æ‰§è¡Œä»£ç çš„`ç¯å¢ƒ/ä½œç”¨åŸŸ`ã€‚è¯´çš„å¤Ÿå¤šäº†ï¼Œç°åœ¨è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªåŒ…å«**å…¨å±€`global context`å’Œå‡½æ•°ä¸Šä¸‹æ–‡`execution context`**çš„ä»£ç ä¾‹å­

![global_context.jpg](global_context.jpg)

å¾ˆç®€å•çš„ä¾‹å­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªè¢«**ç´«è‰²è¾¹æ¡†åœˆ**èµ·æ¥çš„**å…¨å±€ä¸Šä¸‹æ–‡**å’Œä¸‰ä¸ªåˆ†åˆ«è¢«**ç»¿è‰²ï¼Œè“è‰²å’Œæ©˜è‰²**æ¡†èµ·æ¥çš„**ä¸åŒå‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡**ã€‚åªæœ‰å…¨å±€ä¸Šä¸‹æ–‡ï¼ˆçš„å˜é‡ï¼‰èƒ½è¢«å…¶ä»–ä»»ä½•ä¸Šä¸‹æ–‡è®¿é—®ã€‚

ä½ å¯ä»¥æœ‰ä»»æ„å¤šä¸ªå‡½æ•°ä¸Šä¸‹æ–‡ï¼Œ**æ¯æ¬¡è°ƒç”¨å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸Šä¸‹æ–‡**ï¼Œä¼šåˆ›å»ºä¸€ä¸ª**ç§æœ‰ä½œç”¨åŸŸ**ï¼Œå‡½æ•°å†…éƒ¨å£°æ˜çš„ä»»ä½•å˜é‡éƒ½ä¸èƒ½åœ¨å½“å‰å‡½æ•°ä½œç”¨åŸŸå¤–éƒ¨ç›´æ¥è®¿é—®ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå‡½æ•°èƒ½è®¿é—®å½“å‰ä¸Šä¸‹æ–‡å¤–é¢çš„å˜é‡å£°æ˜ï¼Œä½†åœ¨å¤–éƒ¨ä¸Šä¸‹æ–‡ä¸èƒ½è®¿é—®å†…éƒ¨çš„å˜é‡/å‡½æ•°å£°æ˜ã€‚

### æ‰§è¡Œä¸Šä¸‹æ–‡å †æ ˆ è¿™ä¸ªçœ‹é“¾æ¥, ä¹Ÿå¯ä»¥çœ‹é‚£ä¸ªevent loop

**æµè§ˆå™¨**é‡Œçš„`JavaScript`è§£é‡Šå™¨è¢«å®ç°ä¸º**å•çº¿ç¨‹**ã€‚è¿™æ„å‘³ç€åŒä¸€æ—¶é—´åªèƒ½å‘ç”Ÿä¸€ä»¶äº‹æƒ…ï¼Œå…¶ä»–çš„è¡Œæ–‡æˆ–äº‹ä»¶å°†ä¼šè¢«æ”¾åœ¨å«åšæ‰§è¡Œæ ˆé‡Œé¢æ’é˜Ÿã€‚ä¸‹é¢çš„å›¾æ˜¯å•çº¿ç¨‹æ ˆçš„æŠ½è±¡è§†å›¾ï¼š

![stack1.jpg](stack1.jpg)

æœ‰5ä¸ªéœ€è¦è®°ä½çš„å…³é”®ç‚¹ï¼Œ**å…³äºæ‰§è¡Œæ ˆï¼ˆè°ƒç”¨æ ˆï¼‰**ï¼š

- å•çº¿ç¨‹ã€‚
- åŒæ­¥æ‰§è¡Œã€‚
- ä¸€ä¸ªå…¨å±€ä¸Šä¸‹æ–‡ã€‚
- æ— é™åˆ¶å‡½æ•°ä¸Šä¸‹æ–‡ã€‚
- æ¯æ¬¡å‡½æ•°è¢«è°ƒç”¨åˆ›å»ºæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ŒåŒ…æ‹¬è°ƒç”¨è‡ªå·±ã€‚

### æ‰§è¡Œä¸Šä¸‹æ–‡çš„ç»†èŠ‚

æˆ‘ä»¬ç°åœ¨å·²ç»çŸ¥é“æ¯æ¬¡è°ƒç”¨å‡½æ•°ï¼Œéƒ½ä¼šåˆ›å»ºæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚ç„¶è€Œï¼Œåœ¨JavaScriptè§£é‡Šå™¨å†…éƒ¨ï¼Œæ¯æ¬¡è°ƒç”¨æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š

1. **åˆ›å»ºé˜¶æ®µ**ã€å½“å‡½æ•°è¢«è°ƒç”¨ï¼Œä½†æœªæ‰§è¡Œä»»ä½•å…¶å†…éƒ¨ä»£ç ä¹‹å‰ã€‘ï¼š
   - åˆ›å»ºä½œç”¨åŸŸé“¾ï¼ˆ`Scope Chain`ï¼‰
   - åˆ›å»ºå˜é‡å¯¹è±¡`VO`ï¼Œå†…å¯¹åº”çš„variables, functionså’Œargumentsã€‚
   - æ±‚â€`this`â€œçš„å€¼ã€‚
2. æ¿€æ´»/**ä»£ç æ‰§è¡Œ**é˜¶æ®µï¼š
   - é‡æ–°æ‰«æä¸€æ¬¡ä»£ç ï¼Œç»™å˜é‡èµ‹å€¼ï¼Œç„¶åæ‰§è¡Œä»£ç ã€‚ã€‚

å¯ä»¥å°†æ¯ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡æŠ½è±¡ä¸ºä¸€ä¸ªå¯¹è±¡å¹¶æœ‰ä¸‰ä¸ªå±æ€§ï¼š

```JavaScript
executionContextObj = {
    'scopeChain': { /* variableObject + all parent execution context's variableObject */ },
    'variableObject': { /* function arguments / parameters(å‡½æ•°å®å‚/å½¢å‚), inner variable and function declarations */ },
    'this': {}
}
```

`executionContextObj`ç”±å‡½æ•°**è°ƒç”¨æ—¶è¿è¡Œå‰**åˆ›å»ºï¼Œ**åˆ›å»ºé˜¶æ®µ**`arguments`çš„å‚æ•°ä¼šç›´æ¥ä¼ å…¥ï¼Œå‡½æ•°**å†…éƒ¨å®šä¹‰çš„å˜é‡**ä¼šåˆå§‹åŒ–ä¸º`undefined`ã€‚**æ‰§è¡Œé˜¶æ®µ**é‡æ–°æ‰«æä¸€æ¬¡ä»£ç ï¼Œç»™å˜é‡èµ‹å€¼ï¼Œç„¶åæ‰§è¡Œä»£ç ã€‚

#### ä¸‹é¢æ˜¯æ‰§è¡Œä¸Šä¸‹æ–‡æœŸé—´JSå¼•æ“æ‰§è¡Œä¼ªä»£ç 

> è¿™é‡Œå’Œå®šä¹‰æ—¶(é¢„å¤„ç†æ—¶)çš„å‡½æ•°å¯¹è±¡çš„å±æ€§`[[scope]]`ä¸åŒå“¦

1. æ‰¾åˆ°è°ƒç”¨å‡½æ•°
2. æ‰§è¡Œå‡½æ•°ä»£ç å‰ï¼Œåˆ›å»º`execution context`
3. è¿›è¡Œ**åˆ›å»ºé˜¶æ®µ**ï¼š
   - åˆå§‹åŒ–ä½œç”¨åŸŸé“¾ `Scope Chain`
   - åˆ›å»º `variable object`ï¼š(å…¨å±€ä¸‹å°±æ˜¯å…¨å±€å˜é‡, æ²¡æœ‰arguments, `AO`ä¸‹å°±æ˜¯4ç§:å‡½æ•°çš„å½¢å‚å®å‚, å‡½æ•°å†…å£°æ˜çš„å‡½æ•°å’Œå˜é‡)
     - åˆ›å»º`arguments`å¯¹è±¡ï¼Œåˆå§‹åŒ–è¯¥å…¥å‚å˜é‡åå’Œå€¼(**è¿™ä¸ªå‡½æ•°æœ‰, å…¨å±€çš„æ²¡æœ‰**)
     - æ‰«æè¯¥æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­å£°æ˜çš„å‡½æ•°ï¼š (å…¶å®å°±æ˜¯`hostæå‡`, çœ‹{% post_link jsä½œç”¨åŸŸé“¾å’Œé—­åŒ… jsä½œç”¨åŸŸé“¾å’Œé—­åŒ… %}ä¸­çš„æå‡)
       - å¯¹äºå£°æ˜çš„å‡½æ•°ï¼Œ`variable object`ä¸­åˆ›å»ºå¯¹åº”çš„å˜é‡åï¼Œå…¶å€¼æŒ‡å‘è¯¥å‡½æ•°ï¼ˆå‡½æ•°æ˜¯å­˜åœ¨`heap`ä¸­çš„ï¼‰
       - å¦‚æœå‡½æ•°åå·²ç»å­˜åœ¨ï¼Œç”¨æ–°çš„å¼•ç”¨å€¼**è¦†ç›–**å·²æœ‰çš„
     - æ‰«æä¸Šä¸‹æ–‡ä¸­å£°æ˜çš„å˜é‡ï¼š
       - å¯¹äºå˜é‡çš„å£°æ˜ï¼ŒåŒæ ·åœ¨`variable object`ä¸­åˆ›å»ºå¯¹åº”çš„å˜é‡åï¼Œå…¶å€¼åˆå§‹åŒ–`ä¸ºundefined`
       - å¦‚æœå˜é‡çš„åå­—å·²ç»å­˜åœ¨ï¼Œåˆ™ç›´æ¥ç•¥è¿‡ç»§ç»­æ‰«æ
   - å†³å®šä¸Šä¸‹æ–‡`this`çš„æŒ‡å‘
4. ä»£ç æ‰§è¡Œé˜¶æ®µï¼š
   - æ‰§è¡Œå‡½æ•°å†…çš„ä»£ç å¹¶ç»™å¯¹åº”å˜é‡è¿›è¡Œèµ‹å€¼ï¼ˆåˆ›å»ºé˜¶æ®µä¸º`undefined`çš„å˜é‡ï¼‰

**ä¸€ä¸ªç®€å•ä¾‹å­å¦‚ä¸‹**ï¼š

```JavaScript
console.log(foo(22))
console.log(x);

var x = 'hello world';

function foo(i) {
    var a = 'hello';
    var b = function privateB() {

    };

    function c() {

    }

    console.log(i)
}
```

æå‡åæ˜¯å¦‚ä¸‹

```JavaScript
// æå‡å‡½æ•°å£°æ˜
function foo(i) {
    var a = 'hello';
    var b = function privateB() {

    };

    function c() {

    }

    console.log(i)
}
// æå‡å˜é‡çš„
var x

console.log(foo(22))
console.log(x);

x = 'hello world';
```

(a)ï¼šä»£ç é¦–å…ˆè¿›å…¥åˆ°`å…¨å±€ä¸Šä¸‹æ–‡`çš„**åˆ›å»ºé˜¶æ®µ**ã€‚

1. åˆå§‹åŒ–ä½œç”¨åŸŸé“¾ `Scope Chain`
2. åˆ›å»º `variable object`
   1. åˆ›å»º`arguments`å¯¹è±¡ï¼Œåˆå§‹åŒ–è¯¥å…¥å‚å˜é‡åå’Œå€¼(è¿™ä¸ªå‡½æ•°æœ‰, å…¨å±€çš„æ²¡æœ‰)
   2. å‡½æ•°å£°æ˜å’Œå˜é‡å£°æ˜æå‡
3. å†³å®šä¸Šä¸‹æ–‡`this`çš„æŒ‡å‘

å¾—åˆ°å¦‚ä¸‹çš„`ExecutionContextGlobal`

```JavaScript
ExecutionContextGlobal = {
  scopeChain: {...},  // å½“æˆ[]æ›´è´´åˆ‡ç‚¹
  variableObject: {
      x: undefined,
      foo: pointer to function foo()
  },
  this: {...}
}
```

(b): ç„¶åè¿›å…¥`å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡`çš„**æ‰§è¡Œé˜¶æ®µ**ã€‚

è¿™ä¸€é˜¶æ®µä»ä¸Šè‡³ä¸‹é€æ¡æ‰§è¡Œä»£ç ï¼Œè¿è¡Œåˆ°`console.log(foo(22))`è¯¥è¡Œæ—¶ï¼Œ**åˆ›å»ºé˜¶æ®µ**å·²ç»ä¸º`variableObject`ä¸­çš„`foo`èµ‹å€¼äº†ï¼Œå› æ­¤æ‰§è¡Œæ—¶ä¼šæ‰§è¡Œ`foo(22)`å‡½æ•°ã€‚
å½“æ‰§è¡Œ`foo(22)`å‡½æ•°æ—¶ï¼Œåˆå°†è¿›å…¥`foo()`çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œè¯¦è§(c)é˜¶æ®µã€‚
å½“æ‰§è¡Œåˆ°`console.log(x)`æ—¶ï¼Œæ­¤æ—¶`x`åœ¨`variableObject`ä¸­èµ‹å€¼ä¸º`undefined`ï¼Œå› æ­¤æ‰“å°å‡º`undefined`ï¼Œè¿™ä¹Ÿæ­£æ˜¯**å˜é‡æå‡äº§ç”Ÿ**çš„ç»“æœã€‚
å½“æ‰§è¡Œåˆ°`var x = 'hello world';`ï¼Œ`variableObject`ä¸­çš„xè¢«èµ‹å€¼ä¸º`hello world`ã€‚
ç»§ç»­å¾€ä¸‹æ˜¯`foo`å‡½æ•°çš„å£°æ˜ï¼Œå› æ­¤ä»€ä¹ˆä¹Ÿä¸åšï¼Œæ‰§è¡Œé˜¶æ®µç»“æŸã€‚ä¸‹é¢æ˜¯æ‰§è¡Œé˜¶æ®µå®Œæˆåçš„`ExecutionContextGlobal`ã€‚

```JavaScript
ExecutionContextGlobal = {
  scopeChain: {...},  // å½“æˆ[]æ›´è´´åˆ‡ç‚¹
  variableObject: {
      x: 'hello world',
      foo: pointer to function foo()
  },
  this: {...}
}
```

(c): å½“jsè°ƒç”¨`foo(22)`æ—¶ï¼Œè¿›å…¥åˆ°`foo()`å‡½æ•°çš„`æ‰§è¡Œä¸Šä¸‹æ–‡`ï¼Œé¦–å…ˆè¿›è¡Œè¯¥ä¸Šä¸‹æ–‡çš„**åˆ›å»ºé˜¶æ®µ**ã€‚

```JavaScript
ExecutionContextFoo = {
    scopeChain: {...},  // å½“æˆ[]æ›´è´´åˆ‡ç‚¹
    variableObject: {
      arguments: {
        0: 22,
        length: 1
      },
      i: 22,
      c: pointer to function c()
      a: undefined,
      b: undefined
    },
    this: {...}
}
```

å½“**æ‰§è¡Œé˜¶æ®µ**è¿è¡Œå®Œåï¼Œ`ExecutionContextFoo`å¦‚ä¸‹ã€‚

```JavaScript
fooExecutionContext = {
    scopeChain: { ... },  // å½“æˆ[]æ›´è´´åˆ‡ç‚¹
    variableObject: {
        arguments: {
            0: 22,
            length: 1
        },
        i: 22,
        c: pointer to function c()
        a: 'hello',
        b: pointer to function privateB()
    },
    this: { ... }
}
```

ç†æ¸…äº†JSä¸­çš„`æ‰§è¡Œä¸Šä¸‹æ–‡`ï¼Œå°±å¾ˆå®¹æ˜“æ˜ç™½**å˜é‡æå‡**å…·ä½“æ˜¯æ€ä¹ˆå›äº‹äº†ã€‚
åœ¨**ä»£ç æ‰§è¡Œå‰**ï¼Œæ‰§è¡Œä¸Šä¸‹æ–‡å·²ç»ç»™å¯¹åº”çš„å£°æ˜èµ‹å€¼ï¼Œåªä¸è¿‡**å˜é‡æ˜¯èµ‹å€¼**ä¸º`undefined`ï¼Œ**å‡½æ•°èµ‹å€¼**ä¸ºå¯¹åº”çš„å¼•ç”¨ï¼Œ
è€Œååœ¨**æ‰§è¡Œé˜¶æ®µ**å†å°†å¯¹åº”å€¼**èµ‹å€¼**ç»™å˜é‡ã€‚

> **åŒºåˆ†å‡½æ•°å£°æ˜å’Œå‡½æ•°è¡¨è¾¾å¼**, è¿™ä¸ªä¸å†å¤šè¯´

åœ¨å‰é¢çœ‹åˆ°`execution context`ä¸­çš„æ˜¯`VO`, ç„¶å `AO`æ˜¯å•¥

`Variable object(VO)` ï¼šåœ¨**å…¨å±€ä½œç”¨åŸŸ**å°±æ˜¯**å…¨å±€å¯¹è±¡**ï¼Œè€Œåœ¨**å…¶ä»–ä½œç”¨åŸŸ**æ˜¯`æ´»åŠ¨å¯¹è±¡AO`ã€‚
`Activation object(AO)` ï¼šåŒ…å«ï¼šå‡½æ•°çš„`å½¢å¼å‚æ•°`ï¼Œå‡½æ•°çš„`arguments`å¯¹è±¡ï¼Œ`å‡½æ•°å†…å£°æ˜çš„å˜é‡`å’Œ`å†…éƒ¨å‡½æ•°` **4ç§(å‡½æ•°çš„å½¢å‚å®å‚, å‡½æ•°å†…å£°æ˜çš„å‡½æ•°å’Œå˜é‡)**ã€‚

> **å…¶å®`AO`æ˜¯`VO`çš„ä¸€ç§æƒ…å†µ**ã€‚`å…¨å±€ä¸‹æ˜¯æ²¡æœ‰`**arguments**è¿™ä¸ªå¯¹è±¡çš„ï¼Œæ‰€ä»¥**å…¨å±€å¯¹è±¡ä¸èƒ½ç§°ä¸ºæ´»åŠ¨å¯¹è±¡**ã€‚

æœªè¿›å…¥æ‰§è¡Œé˜¶æ®µä¹‹å‰ï¼Œå˜é‡å¯¹è±¡ä¸­çš„å±æ€§éƒ½ä¸èƒ½è®¿é—®ï¼ä½†æ˜¯è¿›å…¥æ‰§è¡Œé˜¶æ®µä¹‹åï¼Œå˜é‡å¯¹è±¡è½¬å˜ä¸ºäº†æ´»åŠ¨å¯¹è±¡ï¼Œé‡Œé¢çš„å±æ€§éƒ½èƒ½è¢«è®¿é—®äº†ï¼Œç„¶åå¼€å§‹è¿›è¡Œæ‰§è¡Œé˜¶æ®µçš„æ“ä½œã€‚

### å…¨å±€ä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡

ä»¥æµè§ˆå™¨ä¸­ä¸ºä¾‹ï¼Œå…¨å±€å¯¹è±¡ä¸º`window`ã€‚
å…¨å±€ä¸Šä¸‹æ–‡æœ‰ä¸€ä¸ªç‰¹æ®Šçš„åœ°æ–¹ï¼Œå®ƒçš„å˜é‡å¯¹è±¡ï¼Œå°±æ˜¯`window`å¯¹è±¡ã€‚è€Œè¿™ä¸ªç‰¹æ®Šï¼Œåœ¨`this`æŒ‡å‘ä¸Šä¹ŸåŒæ ·é€‚ç”¨ï¼Œ`this`ä¹Ÿæ˜¯æŒ‡å‘`window`ã€‚

```JavaScript
// ä»¥æµè§ˆå™¨ä¸­ä¸ºä¾‹ï¼Œå…¨å±€å¯¹è±¡ä¸ºwindow
// å…¨å±€ä¸Šä¸‹æ–‡
windowEC = {
    VO: Window,
    scopeChain: {},  // å½“æˆ[]æ›´è´´åˆ‡ç‚¹
    this: Window
}
```

é™¤æ­¤ä¹‹å¤–ï¼Œå…¨å±€ä¸Šä¸‹æ–‡çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¸ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸä¸€è‡´ï¼Œåªè¦ç¨‹åºè¿è¡Œä¸ç»“æŸï¼Œæ¯”å¦‚å…³æ‰æµè§ˆå™¨çª—å£ï¼Œå…¨å±€ä¸Šä¸‹æ–‡å°±ä¼šä¸€ç›´å­˜åœ¨ã€‚å…¶ä»–æ‰€æœ‰çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œéƒ½èƒ½ç›´æ¥è®¿é—®å…¨å±€ä¸Šä¸‹æ–‡çš„å±æ€§ã€‚

### å¦ä¸€ç§`VO`ä¸æ˜¯`this`

[jsä¸­ æ‰§è¡Œç¯å¢ƒ(execution context) å’Œ ä½œç”¨åŸŸ(scope) çš„åŒºåˆ«åœ¨å“ªé‡Œ?](https://www.zhihu.com/question/51336888)

æ‰§è¡Œç¯å¢ƒï¼ˆ`Execution Context`ï¼Œç®€ç§°`Context`ï¼‰åªæ˜¯ä¸€ä¸ª**æŠ½è±¡æ¦‚å¿µ**ï¼Œåœ¨å…·ä½“`JS Engine`å®ç°ä¸­ï¼Œ**å®ƒå¯¹åº”å¾ˆå¤šå†…å®¹**ï¼Œå˜é‡å¯¹è±¡ï¼ˆ`Variable Object`ï¼Œç®€å†™`VO`ï¼‰æ˜¯å…¶ä¸€ï¼Œè¿˜æœ‰`Scope Chain`ï¼Œ`this`ç­‰ï¼Œè¿™äº›**å…±åŒç»„æˆ**äº†æ‰§è¡Œç¯å¢ƒè¿™ä¸ªæ¦‚å¿µã€‚

`VO`ä¸æ˜¯æŒ‡å…·ä½“æŸä¸ª`Object`ï¼Œè€Œæ˜¯**æŒ‡ä¸€ç±»`Object`**ï¼Œæ‰€ä»¥ä¹Ÿå…·æœ‰ä¸€å®šç¨‹åº¦çš„**æŠ½è±¡**ã€‚

```JavaScript
var color = "blue";

function changeColor(){
    var anotherColor = "red";

    function swapColors(){
        var tempColor = anotherColor;
        anotherColor = color;
        color = tempColor;

        //color, anotherColor, and tempColor are all accessible here
    }

    //color and anotherColor are accessible here, but not tempColor
    swapColors();
}

//only color is accessible here
changeColor();
```

ä¹¦ä¸Šï¼ˆã€ŠJavascripté«˜çº§ç¨‹åºè®¾è®¡(ç¬¬ä¸‰ç‰ˆ)ã€‹ï¼‰çš„ä»£ç ï¼ˆå¦‚ä¸‹ï¼‰è¯´å¾—å¾ˆæ¸…æ¥šï¼š**`global context`å¯¹åº”ä¸€ä¸ª`VO`ï¼ˆå°±æ˜¯`window`!!ï¼‰**, `changeColor`çš„`local context`å¯¹åº”ä¸€ä¸ª`VO`ï¼Œ`swapColors`çš„`local context`å¯¹åº”ä¸€ä¸ª`VO`ã€‚æ‰€ä»¥æ¯ä¸ªcontextéƒ½å¯¹åº”äº†ä¸€ä¸ª`VO`ã€‚

å¦‚ä¸Šæ‰€è¯´ï¼Œ**`this`ä¹Ÿæ˜¯æ‰§è¡Œç¯å¢ƒçš„ä¸€éƒ¨åˆ†**ï¼Œæ‰€ä»¥ä¸è¦ä¸`VO`ææ··ï¼Œ`VO`æ˜¯`JS Engine`**å†…éƒ¨å®ç°**ï¼Œç”¨äº`identifier resolution`ï¼Œ**JSä»£ç å±‚é¢æ˜¯æ¥è§¦ä¸åˆ°çš„**ã€‚å‚è§ES2016è§„èŒƒï¼š

> Lexical Environments and Environment Record values are purely specification mechanisms and need not correspond to any specific artefact of an ECMAScript implementation. It is impossible for an ECMAScript program to directly access or manipulate such values.

å½“ç„¶å¦‚æœä½ è¿™ä¸ª`VO`æ˜¯`global`çš„è¯ï¼Œæ¯”è¾ƒç‰¹æ®Šä¸€ç‚¹ï¼š

> A global environment's Environment Record may be prepopulated with identifier bindings and includes an associated global object whose properties provide some of the global environment's identifier bindings. As ECMAScript code is executed, additional properties may be added to the global object and the initial properties may be modified.

è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå‰é¢æåˆ°è¯´`global context`å¯¹åº”`window`ã€‚

åŒä¸€æœ¬ä¹¦ä¸“é—¨è®²Functionä¸€ç« æœ‰è¿™æ ·ä¸€å¥è¯ï¼š

> The this object is bound at runtime based on the context in which a function is executed: when used inside global functions, this is equal to window in nonstrict mode and undefined in strict mode, whereas this is equal to the object when called as an object method.

ç®€è¨€ä¹‹ï¼Œ`this`åªæ˜¯å­˜äº†ä¸€ä¸ªåœ°å€ï¼Œè¦ä¹ˆæŒ‡å‘`window`ï¼Œè¦ä¹ˆæŒ‡å‘**è°ƒç”¨è¯¥æ–¹æ³•**çš„é‚£ä¸ª`object`ã€‚
æŠŠä¸Šé¢ä»£ç æ”¹ä¸€ä¸‹ï¼š

```JavaScript
var o = {color: "black"};

function changeColor(){
    var color = "red";
    console.log(this === window);
    function swapColors(){
        console.log(this === window);
        console.log(this.color);
        console.log(color);
    }

    swapColors();
}

changeColor(); // Output: true, true, undefined, red
o.changeColor = changeColor;
o.changeColor(); // Output: false, true, undefined, red
```

`swapColors`é‡Œçš„`this`ï¼Œå’Œ`swapColors`çš„`context`å¯¹åº”çš„`VO`æ²¡ä»€ä¹ˆå…³ç³»ï¼Œè€Œæ˜¯æŒ‡å‘`window`ã€‚

### å†è¯´ä¸‹ä½œç”¨åŸŸä¸æ‰§è¡Œä¸Šä¸‹æ–‡

JavaScriptä»£ç çš„æ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹ï¼Œåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œ**ä»£ç ç¼–è¯‘é˜¶æ®µä¸ä»£ç æ‰§è¡Œé˜¶æ®µ**ã€‚
**ç¼–è¯‘é˜¶æ®µ**ç”±ç¼–è¯‘å™¨å®Œæˆï¼Œå°†ä»£ç ç¿»è¯‘æˆå¯æ‰§è¡Œä»£ç ï¼Œè¿™ä¸ªé˜¶æ®µä½œç”¨åŸŸè§„åˆ™ä¼šç¡®å®šã€‚
**æ‰§è¡Œé˜¶æ®µ**ç”±å¼•æ“å®Œæˆï¼Œä¸»è¦ä»»åŠ¡æ˜¯æ‰§è¡Œå¯æ‰§è¡Œä»£ç ï¼Œæ‰§è¡Œä¸Šä¸‹æ–‡åœ¨è¿™ä¸ªé˜¶æ®µåˆ›å»ºã€‚

![process.webp](process.webp)

ç„¶åæ˜¯å‰é¢è¯´çš„`æ‰§è¡Œä¸Šä¸‹æ–‡`çš„**ç”Ÿå‘½å‘¨æœŸ**

![execution_context.webp](execution_context.webp)

### å‡½æ•°è°ƒç”¨æ ˆä¸ä½œç”¨åŸŸé“¾

```JavaScript
var fn = null;
function foo() {
    var a = 2;
    function innnerFoo() {
        console.log(c); // åœ¨è¿™é‡Œï¼Œè¯•å›¾è®¿é—®å‡½æ•°barä¸­çš„cå˜é‡ï¼Œä¼šæŠ›å‡ºé”™è¯¯
        console.log(a);
    }
    fn = innnerFoo; // å°† innnerFooçš„å¼•ç”¨ï¼Œèµ‹å€¼ç»™å…¨å±€å˜é‡ä¸­çš„fn
}

function bar() {
    var c = 100;
    fn(); // æ­¤å¤„çš„ä¿ç•™çš„innerFooçš„å¼•ç”¨
}

foo();
bar();
```

è¿™é‡Œæ‰“å°`c`è¦çœ‹ä½ çš„ä½œç”¨åŸŸé“¾ä¸Šèƒ½ä¸èƒ½æ‰¾åˆ°`c`,è€Œä¸æ˜¯è¯´è°ƒç”¨çš„æ—¶å€™, å‰é¢æœ‰ä¸ª`c`ç”¨è¿‡.

## å‚è€ƒ

[ã€Šé«˜æ€§èƒ½JavaScriptã€‹ç¬¬2ç« ](http://www.menvscode.com/detail/599fd4673bb2bd430d7a7e01)

**é‡ç‚¹æ˜¯è¿™4ç¯‡æ–‡ç« , ç„¶åçœ‹å®Œå°±çœ‹ä¸‹æµè§ˆå™¨çš„æœºåˆ¶, å†çœ‹ä¸‹æ‰§è¡Œä¸Šä¸‹æ–‡çš„ç»“æ„**
[JavaScript æ ¸å¿ƒæ¦‚å¿µä¹‹ä½œç”¨åŸŸå’Œé—­åŒ… 666](https://www.css88.com/archives/7262)
[æ·±å…¥ç†è§£JavaScriptä¸­çš„ä½œç”¨åŸŸå’Œä¸Šä¸‹æ–‡ 666](https://www.css88.com/archives/7255)
[å®ä¾‹åˆ†æ JavaScript ä½œç”¨åŸŸ 6666](https://www.css88.com/archives/7300)
[JavaScript ä¸­çš„ Hoisting (å˜é‡æå‡å’Œå‡½æ•°å£°æ˜æå‡) 666](https://www.css88.com/archives/7924)

{% post_link ä»è¾“å…¥URLåˆ°é¡µé¢åŠ è½½å‘ç”Ÿäº†ä»€ä¹ˆ ä»è¾“å…¥URLåˆ°é¡µé¢åŠ è½½å‘ç”Ÿäº†ä»€ä¹ˆ %}

[äº†è§£JavaScriptçš„æ‰§è¡Œä¸Šä¸‹æ–‡](https://yanhaijing.com/javascript/2014/04/29/what-is-the-execution-context-in-javascript/)
[ç”±å˜é‡æå‡è°ˆè°ˆ JavaScript Execution Context](https://juejin.im/post/5a5ee28f6fb9a01cbe655860)

[jsä¸­ æ‰§è¡Œç¯å¢ƒ(execution context) å’Œ ä½œç”¨åŸŸ(scope) çš„åŒºåˆ«åœ¨å“ªé‡Œ?](https://www.zhihu.com/question/51336888)
[js ä¸­çš„æ´»åŠ¨å¯¹è±¡ ä¸ å˜é‡å¯¹è±¡ ä»€ä¹ˆåŒºåˆ«ï¼Ÿ](https://www.zhihu.com/question/36393048)

[è®²æ¸…æ¥šä¹‹javascriptä½œç”¨åŸŸ](https://segmentfault.com/a/1190000014980841)
[æ·±å…¥ç†è§£JSä¸­å£°æ˜æå‡ã€ä½œç”¨åŸŸï¼ˆé“¾ï¼‰å’Œ`this`å…³é”®å­—](https://github.com/creeperyang/blog/issues/16)
[å›¾è§£JSé—­åŒ…å½¢æˆçš„åŸå› ](https://segmentfault.com/a/1190000011504517)